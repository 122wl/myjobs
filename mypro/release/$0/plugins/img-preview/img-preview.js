!function(n){n.fn.imgPreview=function(i){function s(){e(),a()}function t(i){var s=n("<li></li>"),t="translate3d("+(i-o.curIndex)*h+"px,0,0)";s.css("transform",t),s.css("-ms-transform",t),s.css("-moz-transform",t),s.css("-webkit-transform",t),s.css("-o-transform",t);var e=n('<img src = "'+o.imgs[i]+'"/>');!function(n){var i=new Image;i.src=n.attr("src"),i.onload=function(){var s=i.width,t=i.height,e=s/t;s>h&&e>g&&n.width(h),t>f&&g>e&&n.height(f),n.parent().find(".loading").hide()}}(e);var r=n("<img class='loading' src = 'load.gif' />").css({left:h/2-15+"px",top:f/2-15+"px"});return s.append(r),s.append(e),l.append(s),s}function e(){var i=[];i.push('<div class="bar">'),i.push('	<a class="back" href="javascript:;"><i class="icon-back"></i></a>'),i.push('	<div class="num-view"><span class="current-index"></span>/<span class="totle"></span></div>'),i.push('	<a class="del" href="javascript:;"><i class="icon-rubbish"></i></a>'),i.push("</div>"),d=n(i.join("")),d.find(".current-index").html(o.curIndex+1),d.find(".totle").html(u),l=n("<ul class='img-view'></ul>");for(var s=(o.imgs,0);u>s;s++)t(s);c.append(l),c.append(d)}function r(n){o.curIndex=o.curIndex+n,o.curIndex<0&&(o.curIndex=0),o.curIndex>u-1&&(o.curIndex=u-1),d.find(".current-index").html(o.curIndex+1);for(var i=0;u>i;i++){var s=c.find("li:eq("+i+")"),t="translate3d("+(i-o.curIndex)*h+"px,0,0)";s.css("transition","all .3s linear"),s.css("-moz-transition","all .3s linear"),s.css("-webkit-transition","all .3s linear"),s.css("-o-transition","all .3s linear"),s.css("transform",t),s.css("-ms-transform",t),s.css("-moz-transform",t),s.css("-webkit-transform",t),s.css("-o-transform",t)}}function a(){var n,i=function(){var n=o.curIndex;o.curIndex==o.imgs.length-1?(r(-1),o.curIndex=n-1):(r(1),o.curIndex=n),o.imgs.splice(n,1),d.find(".current-index").html(o.curIndex+1),c.find(".img-view").find("li:eq("+n+")").remove(),u=o.imgs.length,d.find(".totle").html(u),0==u&&c.hide(),o.delCallback(n)},s=function(){c.hide()},t=function(i){i.stopPropagation();var s=i.originalEvent.changedTouches;if(1==s.length){var t=i.originalEvent.changedTouches[0];n=t.pageX}},e=function(i){i.stopPropagation();var s=i.originalEvent.changedTouches;if(1==s.length){var t=i.originalEvent.changedTouches[0],e=t.pageX;e-n>50&&r(-1),-50>e-n&&r(1),r(0)}},a=function(i){i.stopPropagation();var s=i.originalEvent.changedTouches;if(1==s.length)for(var t=i.originalEvent.changedTouches[0],e=t.pageX-n,r=0;u>r;r++){var a=c.find("li:eq("+r+")"),d="translate3d("+((r-o.curIndex)*h+e)+"px,0,0)";a.css("transform",d),a.css("-ms-transform",d),a.css("-moz-transform",d),a.css("-webkit-transform",d),a.css("-o-transform",d),a.css("transition","none"),a.css("-moz-transition","none"),a.css("-webkit-transition","none"),a.css("-o-transition","none")}return!1};c.find(".bar").find(".back").on("click",s),c.find(".bar").find(".del").on("click",i),c.on("touchstart",t),c.on("touchend",e),c.on("touchmove",a)}var o={imgs:[],curIndex:0,delCallback:function(){}};n.extend(o,i);var c=n(this),d=null,l=null,u=o.imgs.length,h=n(window).width(),f=n(window).height(),g=h/f;return s(),c[0].t={setIndex:function(n){r(n-o.curIndex)},showView:function(){c.show()},hideView:function(){c.hide()},addImg:function(n){o.imgs.push(n),t(o.imgs.length-1),d.find(".totle").html(o.imgs.length),u=o.imgs.length}},c},n.fn.setIndex=function(n){return this[0]&&this[0].t?this[0].t.setIndex(n):null},n.fn.showView=function(){return this[0]&&this[0].t?this[0].t.showView():null},n.fn.hideView=function(){return this[0]&&this[0].t?this[0].t.hideView():null},n.fn.addImg=function(n){return this[0]&&this[0].t?this[0].t.addImg(n):null}}(jQuery);
!function(n){n.fn.VoiceRecord=function(t){function c(){g.push('<div class="voice-cover">'),g.push('	<div class="voice-loading">'),g.push('		<canvas id="voiceCanvas" width="186px" height="186px">'),g.push("</canvas>"),g.push('		<div class="voice-icon-con">'),g.push('			<i class="icon-yuyin"></i>'),g.push('			<span class="second">0&nbsp;&quot;</span>'),g.push("		</div>"),g.push('		<a class="re-record" href="javascript:;">重录</a>'),g.push("	</div>"),g.push('	<div class="bottons">'),g.push('		<a class="voice-btn cancel-btn" href="javascript:;">取消</a>'),g.push('		<a class="voice-btn end-btn" href="javascript:;">结束录音</a>'),g.push("	</div> "),g.push("</div>"),y=n(g.join("")),P.append(y)}function e(){y.find(".re-record").on("click",function(){h.reRecordCallBack(),i()}),y.find(".cancel-btn").on("click",function(){d()}),y.find(".end-btn").on("click",function(){o()})}function a(){c(),e(),u=document.getElementById("voiceCanvas"),f=u.getContext("2d"),v=u.width,p=u.height}function i(){void 0!=typeof I&&clearInterval(I),y.find(".second").html("0&nbsp;&quot;"),h.startRecord(),f.clearRect(0,0,v,p),M=0,k=0,s(),I=setInterval(s,Math.ceil(h.endSecond/360*1e3))}function o(){h.endCallBack(Math.ceil(M/C)),clearInterval(I)}function s(){void 0!=typeof b&&clearInterval(b),k+=1,difference=k-M,r()}function r(){if(M==k&&clearInterval(b),360==M)return void o();k>M?M++:M--,f.clearRect(0,0,v,p);var n=M*Math.PI/180;f.beginPath(),f.strokeStyle=R,f.lineWidth=10,f.arc(v/2-1,p/2-1,(v-10)/2,0-90*Math.PI/180,n-90*Math.PI/180,!1),f.stroke();var t,c,e=v/2-5;t=v/2+e*Math.sin(M*(Math.PI/180)),c=v/2-e*Math.cos(M*(Math.PI/180)),f.beginPath(),f.fillStyle="#fff",f.arc(t,c,5,0,2*Math.PI,!0),f.closePath(),f.fill(),y.find(".second").html(Math.ceil(M/C)+"&nbsp;&quot;")}function l(){y.show()}function d(){void 0!=typeof I&&clearInterval(I),y.find(".second").html("0&nbsp;&quot;"),f.clearRect(0,0,v,p),M=0,k=0,y.hide()}var h={color:"#2792ff",endSecond:10,startRecord:function(){},endCallBack:function(){},reRecordCallBack:function(){}};n.extend(h,t);var u,f,v,p,b,I,M=0,R=h.color,k=0,y=null,P=n(this),g=[],C=360/h.endSecond;return a(),P[0].t={startRecord:function(){l(),i()}},P},n.fn.startRecord=function(){return this[0]&&this[0].t?this[0].t.startRecord():null}}(jQuery);